<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Tickets - Boston Celtics Fan Page</title>
    <link rel="icon" href="../images/backgrounds/celticsweb.png" type="image/png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        /* Additional styles specific to this page */
        .login-required-container {
            max-width: 800px;
            margin: 100px auto;
            padding: 3rem;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(186, 150, 83, 0.3);
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from {opacity: 0; transform: translateY(20px);}
            to {opacity: 1; transform: translateY(0);}
        }
        
        .login-required-icon {
            font-size: 4rem;
            color: var(--celtics-gold);
            margin-bottom: 1.5rem;
        }
        
        .login-required-title {
            color: var(--white);
            font-size: 2rem;
            margin-bottom: 1rem;
        }
        
        .login-required-message {
            color: #aaa;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .login-options {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        
        .login-btn, .register-btn {
            padding: 1rem 2rem;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .login-btn {
            background: var(--celtics-green);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 122, 51, 0.3);
        }
        
        .login-btn:hover {
            background: #008f3e;
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 122, 51, 0.4);
        }
        
        .register-btn {
            background: rgba(186, 150, 83, 0.2);
            color: var(--celtics-gold);
            border: 1px solid var(--celtics-gold);
        }
        
        .register-btn:hover {
            background: rgba(186, 150, 83, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.1);
        }

        /* Enhanced ticket form styles */
        .ticket-container {
            max-width: 900px;
            margin: 80px auto;
            padding: 0;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(186, 150, 83, 0.3);
            animation: fadeIn 0.5s ease;
            overflow: hidden;
        }
        
        .ticket-header {
            padding: 2.5rem;
            background: linear-gradient(to right, rgba(0, 122, 51, 0.9), rgba(0, 122, 51, 0.7));
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ticket-title {
            color: white;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .ticket-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 400;
        }
        
        .ticket-form {
            padding: 2.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-group label {
            font-weight: 500;
            color: #ddd;
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-select, .form-input {
            width: 100%;
            padding: 16px 16px;
            line-height: 1.4;
            color: white;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        .form-select:hover, .form-input:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .input-wrapper {
            position: relative;
            display: block;
            width: 100%;
        }

        .field-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 16px;
            color: var(--celtics-gold);
            font-size: 1rem;
            pointer-events: none;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Allow extra space for the icon */
        .field-has-icon .form-select, 
        .field-has-icon .form-input {
            padding-left: 46px;
        }
        
        /* Customize select element height to match */
        select.form-select {
            height: 56px;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23BA9653' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: calc(100% - 16px) center;
            background-color: rgba(255, 255, 255, 0.07);
            padding-right: 40px;
            background-size: 16px;
        }
        
        /* Keep arrow static on hover/focus and fix background */
        select.form-select:hover,
        select.form-select:focus {
            background-position: calc(100% - 16px) center !important;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23BA9653' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") !important;
            background-color: rgba(255, 255, 255, 0.1) !important;
            background-repeat: no-repeat !important;
            background-size: 16px !important;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Focus and hover effects */
        .form-select:focus, 
        .form-input:focus {
            border-color: var(--celtics-gold);
            box-shadow: 0 0 0 3px rgba(186, 150, 83, 0.25);
            outline: none;
        }
        
        .form-select option {
            background-color: #111;
            color: white;
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .error-message, .success-message {
            padding: 12px 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            font-weight: 500;
            display: none;
        }
        
        .error-message {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.2);
        }
        
        .success-message {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }

        .ticket-btn {
            background: var(--celtics-green);
            color: white;
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 122, 51, 0.3);
            display: block;
            margin: 30px auto 10px;
        }

        .ticket-btn:hover {
            background: #008f3e;
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(0, 122, 51, 0.4);
        }
        
        .ticket-btn:disabled {
            background: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .ticket-info {
            margin: 0;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ticket-info h3 {
            color: var(--celtics-gold);
            font-size: 1.3rem;
            position: relative;
            padding-bottom: 0.8rem;
            margin-bottom: 1.2rem;
        }

        .ticket-info h3:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--celtics-gold);
            border-radius: 2px;
        }

        .ticket-info ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .ticket-info li {
            padding: 0.7rem 0;
            color: #ccc;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
        }

        .ticket-info li:last-child {
            border-bottom: none;
        }
        
        .ticket-info li i {
            color: var(--celtics-gold);
            margin-right: 10px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        /* Seating chart */
        .seating-chart-container {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            text-align: center;
        }
        
        .seating-chart-title {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .seating-chart-title i {
            margin-right: 10px;
            color: var(--celtics-gold);
        }
        
        /* Updated seating chart styling */
        .arena-image-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 20px;
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .seating-chart-image {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .seating-legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 1.5rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: #ddd;
            padding: 6px 12px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .legend-icon {
            margin-right: 6px;
            color: var(--celtics-gold);
        }
        
        /* Progress steps */
        .form-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 60px;
            position: relative;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .form-progress:before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1;
        }
        
        .progress-step {
            position: relative;
            z-index: 2;
            background: rgba(0, 0, 0, 0.5);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-weight: 600;
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .progress-step.active {
            background: var(--celtics-green);
            color: white;
            border-color: var(--celtics-green);
            box-shadow: 0 0 0 3px rgba(0, 122, 51, 0.3);
        }
        
        .progress-step.completed {
            background: var(--celtics-gold);
            color: black;
            border-color: var(--celtics-gold);
        }
        
        .progress-steps-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }
        
        .progress-step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 33.33%;
        }
        
        .progress-step-label {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #999;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .progress-step-item-active .progress-step-label {
            color: var(--celtics-green);
            font-weight: 500;
        }
        
        .progress-step-item-completed .progress-step-label {
            color: var(--celtics-gold);
            font-weight: 500;
        }
        
        .price-calculator {
            margin-top: 20px;
            padding: 15px;
            background: rgba(186, 150, 83, 0.15);
            border-radius: 8px;
            border: 1px dashed rgba(186, 150, 83, 0.3);
        }
        
        .price-calculator-title {
            font-size: 1rem;
            color: var(--celtics-gold);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .price-calculator-title i {
            margin-right: 8px;
        }
        
        .price-breakdown {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 0.9rem;
        }
        
        .price-total {
            font-weight: 700;
            color: white;
            font-size: 1.1rem;
            margin-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }
            
            .ticket-header {
                padding: 1.5rem;
            }
            
            .ticket-title {
                font-size: 1.8rem;
            }
            
            .ticket-form {
                padding: 1.5rem;
            }
            
            .form-progress {
                max-width: 300px;
            }
            
            .form-progress:before {
                left: 30px;
                right: 30px;
            }
            
            .progress-step-label {
                font-size: 0.7rem;
            }
        }

        /* Enhanced login required styles */
        .login-required-content {
            padding: 2rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .login-message-icon {
            font-size: 4.5rem;
            color: var(--celtics-gold);
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .login-message-text {
            color: #ddd;
            font-size: 1.2rem;
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto 1rem;
        }

        .login-message-accent {
            color: var(--celtics-gold);
            font-weight: 500;
        }

        .login-buttons {
            display: flex;
            gap: 1.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .login-btn, .register-btn {
            padding: 1rem 2.5rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.7rem;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .login-btn {
            background: var(--celtics-green);
            color: white;
        }

        .login-btn:hover {
            background: #008f3e;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .register-btn {
            background: rgba(186, 150, 83, 0.15);
            color: var(--celtics-gold);
            border: 2px solid var(--celtics-gold);
        }

        .register-btn:hover {
            background: rgba(186, 150, 83, 0.25);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .login-divider {
            display: flex;
            align-items: center;
            width: 80%;
            max-width: 400px;
            margin: 1rem auto;
        }

        .login-divider:before, .login-divider:after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .login-divider-text {
            padding: 0 1rem;
            color: #777;
            font-size: 0.9rem;
        }

        .tickets-container {
            max-width: 1200px;
            margin: 120px auto 80px;
            padding: 30px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(186, 150, 83, 0.2);
            color: #fff;
            position: relative;
            z-index: 10;
        }
        
        .tickets-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--celtics-gold);
            padding-bottom: 1rem;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .tickets-title {
            color: var(--celtics-gold);
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .tickets-title i {
            font-size: 1.6rem;
        }
        
        .tickets-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .tickets-btn {
            padding: 10px 20px;
            border-radius: 8px;
            background-color: var(--celtics-green);
            color: #fff;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .tickets-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .tickets-btn.secondary {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .tickets-btn.secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* Footer margin adjustment */
        .footer {
            margin-top: 80px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-left">
                <a href="/">
                    <img src="../images/backgrounds/logo2.svg" alt="Celtics Logo" class="logo-img">
                </a>
                <div class="nav-links">
                    <a href="/#news" class="nav-link">News</a>
                    <a href="/schedule" class="nav-link">Schedule</a>
                    <a href="/roster" class="nav-link">Roster</a>
                    <a href="/standings" class="nav-link">Standings</a>
                    <a href="/getTickets" class="nav-link active">Get Tickets</a>
                </div>
            </div>
            <div class="nav-right">
                <a href="/login" class="btn btn-outline">Login</a>
                <a href="/register" class="btn btn-outline">Sign Up</a>
                <a href="/#footer-contact" class="btn btn-outline">Contact</a>
            </div>
            <button class="mobile-menu-btn" aria-label="Toggle mobile menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </nav>

    <div id="content-container">
        <!-- This container will be filled dynamically by JavaScript -->
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <img src="../images/backgrounds/logo2.svg" alt="Celtics Logo" class="footer-logo">
                <p class="footer-description">The most successful team in NBA history, with 18 championships and counting.</p>
                <div class="social-links">
                    <a href="https://www.facebook.com/bostonceltics/" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="https://www.instagram.com/celtics/?hl=en" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://x.com/celtics" target="_blank" rel="noopener noreferrer">
                        <i class="fa-solid fa-x"></i>
                    </a>
                </div>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul class="footer-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/#news">News</a></li>
                    <li><a href="/schedule">Schedule</a></li>
                    <li><a href="/roster">Roster</a></li>
                    <li><a href="/standings">Standings</a></li>
                    <li><a href="/getTickets">Tickets</a></li>
                </ul>
            </div>
            <div class="footer-section" id="footer-contact">
                <h4>Contact Us</h4>
                <ul class="contact-info">
                    <li>
                        <i class="fas fa-user"></i>
                        <span>Yoav Cohen</span>
                    </li>
                    <li>
                        <i class="fas fa-envelope"></i>
                        <span>yoav23cohen@gmail.com</span>
                    </li>
                    <li>
                        <i class="fas fa-phone"></i>
                        <span>+972 52-466-9882</span>
                    </li>
                    <li>
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Herut, Israel</span>
                    </li>
                    <li>
                        <a href="https://www.linkedin.com/in/yoav-cohen-42b4272a5/" target="_blank" rel="noopener noreferrer">
                            <i class="fab fa-linkedin"></i>
                            <span>LinkedIn Profile</span>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>Newsletter</h4>
                <p>Subscribe to get the latest Celtics news and updates.</p>
                <div class="newsletter-form">
                    <input type="email" placeholder="Enter your email">
                    <button type="submit">Subscribe</button>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <div class="footer-bottom-content">
                <p>&copy; 2024 Boston Celtics. All rights reserved.</p>
                <div class="footer-legal">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Cookie Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="../js/auth.js"></script>
    <script>
        // This function will create and return the ticket form
        function createTicketForm() {
            return `
                <div class="ticket-container">
                    <div class="ticket-header">
                        <h1 class="ticket-title">Request Tickets</h1>
                        <p class="ticket-subtitle">Select your preferred game and seating options</p>
                    </div>

                    <div class="ticket-form">
                        <div class="form-progress">
                            <div class="progress-steps-container">
                                <div class="progress-step-item">
                                    <div class="progress-step" id="step1">
                                        <span>1</span>
                                    </div>
                                    <div class="progress-step-label">Game Selection</div>
                                </div>
                                <div class="progress-step-item">
                                    <div class="progress-step" id="step2">
                                        <span>2</span>
                                    </div>
                                    <div class="progress-step-label">Seating</div>
                                </div>
                                <div class="progress-step-item">
                                    <div class="progress-step" id="step3">
                                        <span>3</span>
                                    </div>
                                    <div class="progress-step-label">Confirmation</div>
                                </div>
                            </div>
                        </div>

                        <div id="errorMessage" class="error-message"></div>
                        <div id="successMessage" class="success-message"></div>

                        <form id="ticketForm" class="ticket-form">
                            <div class="form-row">
                                <div class="form-group field-has-icon">
                                    <label for="game">Select Game</label>
                                    <div class="input-wrapper">
                                        <select id="game" name="game" class="form-select" required>
                                            <option value="">Choose a game</option>
                                            <option value="celtics-vs-lakers">Celtics vs Lakers - March 25, 2024</option>
                                            <option value="celtics-vs-warriors">Celtics vs Warriors - March 28, 2024</option>
                                            <option value="celtics-vs-bucks">Celtics vs Bucks - March 30, 2024</option>
                                            <option value="celtics-vs-76ers">Celtics vs 76ers - April 2, 2024</option>
                                            <option value="celtics-vs-suns">Celtics vs Suns - April 5, 2024</option>
                                        </select>
                                        <i class="fas fa-calendar field-icon"></i>
                                    </div>
                                </div>

                                <div class="form-group field-has-icon">
                                    <label for="sectionType">Section Type</label>
                                    <div class="input-wrapper">
                                        <select id="sectionType" name="sectionType" class="form-select" required onchange="updateSectionOptions()">
                                            <option value="">Choose section type...</option>
                                            <option value="floor">Floor Sections</option>
                                            <option value="vip">VIP Sections</option>
                                            <option value="lower">Lower-Level Sections</option>
                                            <option value="mid">Mid-Level Sections</option>
                                            <option value="upper">Upper-Level Sections</option>
                                            <option value="special">Suites & Special Areas</option>
                                        </select>
                                        <i class="fas fa-layer-group field-icon"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group field-has-icon">
                                    <label for="seatSection">Section Number</label>
                                    <div class="input-wrapper">
                                        <select id="seatSection" name="section" class="form-select" required onchange="updatePriceEstimate()" disabled>
                                            <option value="">First select section type...</option>
                                        </select>
                                        <i class="fas fa-map-marker-alt field-icon"></i>
                                    </div>
                                </div>

                                <div class="form-group field-has-icon">
                                    <label for="ticketQuantity">Number of Tickets</label>
                                    <div class="input-wrapper">
                                        <select id="ticketQuantity" name="quantity" class="form-select" required onchange="updatePriceEstimate()">
                                            <option value="">Select quantity...</option>
                                            <option value="1">1 Ticket</option>
                                            <option value="2">2 Tickets</option>
                                            <option value="3">3 Tickets</option>
                                            <option value="4">4 Tickets</option>
                                        </select>
                                        <i class="fas fa-ticket-alt field-icon"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="seating-chart-container">
                                <h3 class="seating-chart-title"><i class="fas fa-chair"></i> TD Garden Seating Chart</h3>
                                <div class="arena-image-container">
                                    <img src="../images/backgrounds/courtseating.png" alt="TD Garden Seating Chart" class="seating-chart-image">
                                </div>
                                <div class="seating-legend">
                                    <div class="legend-item">
                                        <i class="fas fa-circle legend-icon"></i>
                                        <span>Floor/VIP Sections</span>
                                    </div>
                                    <div class="legend-item">
                                        <i class="fas fa-circle legend-icon"></i>
                                        <span>Lower Level (1-22)</span>
                                    </div>
                                    <div class="legend-item">
                                        <i class="fas fa-circle legend-icon"></i>
                                        <span>Mid Level (107-115, 137-145)</span>
                                    </div>
                                    <div class="legend-item">
                                        <i class="fas fa-circle legend-icon"></i>
                                        <span>Upper Level (300s)</span>
                                    </div>
                                </div>
                            </div>

                            <div id="priceEstimate" class="price-calculator" style="display: none;">
                                <div class="price-calculator-title">
                                    <i class="fas fa-calculator"></i> Estimated Price
                                </div>
                                <div class="price-breakdown">
                                    <div class="price-item">
                                        <span>Base ticket price:</span>
                                        <span id="basePrice">$0.00</span>
                                    </div>
                                    <div class="price-item">
                                        <span>Service fee:</span>
                                        <span id="serviceFee">$0.00</span>
                                    </div>
                                    <div class="price-item">
                                        <span>Processing fee:</span>
                                        <span id="processingFee">$0.00</span>
                                    </div>
                                </div>
                                <div class="price-total">
                                    <span>Total (estimated):</span>
                                    <span id="totalPrice">$0.00</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="specialRequests">Special Requests</label>
                                <textarea id="specialRequests" name="specialRequests" class="form-input form-textarea" placeholder="Any special requirements or preferences..."></textarea>
                            </div>

                            <button type="submit" class="ticket-btn">Submit Request</button>
                        </form>
                    </div>

                    <div class="ticket-info">
                        <h3>Important Information</h3>
                        <ul>
                            <li><i class="fas fa-info-circle"></i> Ticket requests are subject to availability</li>
                            <li><i class="fas fa-clock"></i> Processing time: 24-48 hours</li>
                            <li><i class="fas fa-dollar-sign"></i> Payment will be processed after confirmation</li>
                            <li><i class="fas fa-envelope"></i> You will receive confirmation via email</li>
                            <li><i class="fas fa-user-shield"></i> All transactions are secure and protected</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Create content for non-authenticated users
        function createLoginMessage() {
            return `
                <div class="ticket-container">
                    <div class="ticket-header">
                        <h1 class="ticket-title">Request Tickets</h1>
                        <p class="ticket-subtitle">Boston Celtics Premium Experience</p>
                    </div>
                    
                    <div class="ticket-form">
                        <div class="login-required-content">
                            <div>
                                <i class="fas fa-ticket-alt login-message-icon"></i>
                                <h2>Access Your Ticket Portal</h2>
                                <p class="login-message-text">
                                    To request tickets, please <span class="login-message-accent">log in to your account</span> or create a new account if you don't have one.
                                </p>
                            </div>
                            
                            <div class="login-divider">
                                <span class="login-divider-text">Quick Access</span>
                            </div>
                            
                            <div class="login-buttons">
                                <a href="/login?redirect=getTickets" class="login-btn">
                                    <i class="fas fa-sign-in-alt"></i> Log In
                                </a>
                                <a href="/register" class="register-btn">
                                    <i class="fas fa-user-plus"></i> Create Account
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="ticket-info">
                        <h3>Member Benefits</h3>
                        <ul>
                            <li><i class="fas fa-check-circle"></i> Priority access to playoff and special event tickets</li>
                            <li><i class="fas fa-tag"></i> Exclusive member discounts on merchandise</li>
                            <li><i class="fas fa-bell"></i> Get notified when new tickets become available</li>
                            <li><i class="fas fa-history"></i> View and manage your ticket history</li>
                            <li><i class="fas fa-star"></i> Earn rewards with every purchase</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Check if user is authenticated
        async function checkAccessAndRender() {
            try {
                const response = await fetch('/api/auth/status', {
                    credentials: 'include'
                });
                const data = await response.json();
                const contentContainer = document.getElementById('content-container');
                
                if (data.isAuthenticated) {
                    // Show ticket request form for authenticated users
                    contentContainer.innerHTML = createTicketForm();
                    
                    // Add event listener for form submission
                    document.getElementById('ticketForm').addEventListener('submit', submitTicketRequest);
                    
                    // Add input validation
                    setupFormValidation();
                    
                    // Initialize the first step as active
                    const step1 = document.getElementById('step1');
                    const stepItem1 = step1.closest('.progress-step-item');
                    if (step1 && stepItem1) {
                        step1.classList.add('active');
                        stepItem1.classList.add('progress-step-item-active');
                    }
                    
                    // Set up event listeners for form fields to update steps
                    const formFields = document.querySelectorAll('#game, #sectionType, #seatSection, #ticketQuantity');
                    formFields.forEach(field => {
                        field.addEventListener('change', updateProgressSteps);
                    });
                } else {
                    // Show message for non-authenticated users
                    contentContainer.innerHTML = createLoginMessage();
                }
            } catch (error) {
                console.error('Error checking authentication:', error);
                document.getElementById('content-container').innerHTML = `
                    <div class="error-container">
                        <h2>Something went wrong</h2>
                        <p>We encountered an error while checking your authentication status. Please try again later.</p>
                        <p>Error details: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Form validation
        function setupFormValidation() {
            const form = document.getElementById('ticketForm');
            const formInputs = form.querySelectorAll('select, input, textarea');
            
            formInputs.forEach(input => {
                input.addEventListener('change', function() {
                    validateInput(this);
                    updateProgressSteps();
                });
                
                input.addEventListener('blur', function() {
                    validateInput(this);
                });
            });
            
            // Initial validation for pre-filled fields
            formInputs.forEach(input => validateInput(input));
            updateProgressSteps();
        }
        
        function validateInput(input) {
            const formGroup = input.closest('.form-group');
            
            if (input.hasAttribute('required') && !input.value) {
                formGroup.classList.add('has-error');
                return false;
            } else {
                formGroup.classList.remove('has-error');
                return true;
            }
        }
        
        // Update progress steps based on form completion
        function updateProgressSteps() {
            const gameField = document.getElementById('game');
            const sectionTypeField = document.getElementById('sectionType');
            const sectionField = document.getElementById('seatSection');
            const quantityField = document.getElementById('ticketQuantity');
            
            // Get the step elements by ID
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            
            // Get the step item containers
            const stepItem1 = step1.closest('.progress-step-item');
            const stepItem2 = step2.closest('.progress-step-item');
            const stepItem3 = step3.closest('.progress-step-item');
            
            // Reset all steps
            step1.classList.remove('active', 'completed');
            step2.classList.remove('active', 'completed');
            step3.classList.remove('active', 'completed');
            
            // Reset all step items
            stepItem1.classList.remove('progress-step-item-active', 'progress-step-item-completed');
            stepItem2.classList.remove('progress-step-item-active', 'progress-step-item-completed');
            stepItem3.classList.remove('progress-step-item-active', 'progress-step-item-completed');
            
            // Step 1: Game Selection
            if (gameField.value) {
                step1.classList.add('completed');
                stepItem1.classList.add('progress-step-item-completed');
            } else {
                step1.classList.add('active');
                stepItem1.classList.add('progress-step-item-active');
                return;
            }
            
            // Step 2: Seating
            if (sectionTypeField.value && sectionField.value && quantityField.value) {
                step2.classList.add('completed');
                stepItem2.classList.add('progress-step-item-completed');
            } else {
                step2.classList.add('active');
                stepItem2.classList.add('progress-step-item-active');
                return;
            }
            
            // Step 3: Only activate if all previous steps are completed
            step3.classList.add('active');
            stepItem3.classList.add('progress-step-item-active');
        }
        
        // Estimate price based on selections
        function updatePriceEstimate() {
            const sectionType = document.getElementById('sectionType').value;
            const section = document.getElementById('seatSection').value;
            const quantity = parseInt(document.getElementById('ticketQuantity').value) || 0;
            
            if (!sectionType || !section || !quantity) {
                document.getElementById('priceEstimate').style.display = 'none';
                return;
            }
            
            let basePrice = 0;
            
            // Determine base price based on section type
            if (sectionType === 'floor') {
                basePrice = 750; // Floor sections are most premium
            } else if (sectionType === 'vip') {
                basePrice = 600; // VIP sections
            } else if (sectionType === 'lower') {
                basePrice = 350; // Lower level
            } else if (sectionType === 'mid') {
                basePrice = 225; // Mid level
            } else if (sectionType === 'upper') {
                basePrice = 120; // Upper level
            } else if (sectionType === 'special') {
                basePrice = 900; // Suites & special areas
            }
            
            // Add price variations for premium sections
            if (['FL20', 'FL21'].includes(section)) basePrice += 100; // Best floor seats
            if (['VIP12'].includes(section)) basePrice += 75; // Best VIP area
            if (['12', '21'].includes(section)) basePrice += 50; // Best lower level
            if (['garden-deck', 'exec-suites'].includes(section)) basePrice += 150; // Premium special areas
            
            // Apply quantity discount
            let quantityMultiplier = 1;
            if (quantity >= 5) {
                quantityMultiplier = 0.9; // 10% discount for 5+ tickets
            } else if (quantity >= 3) {
                quantityMultiplier = 0.95; // 5% discount for 3-4 tickets
            }
            
            const serviceFee = basePrice * 0.15;
            const processingFee = 5;
            const totalPrice = (basePrice + serviceFee + processingFee) * quantity * quantityMultiplier;
            
            document.getElementById('basePrice').textContent = `$${basePrice.toFixed(2)}`;
            document.getElementById('serviceFee').textContent = `$${serviceFee.toFixed(2)}`;
            document.getElementById('processingFee').textContent = `$${processingFee.toFixed(2)}`;
            document.getElementById('totalPrice').textContent = `$${totalPrice.toFixed(2)}`;
            
            document.getElementById('priceEstimate').style.display = 'block';
        }

        // JavaScript functions to update the sections dropdown
        function updateSectionOptions() {
            const sectionType = document.getElementById('sectionType').value;
            const sectionSelect = document.getElementById('seatSection');
            
            // Clear existing options
            sectionSelect.innerHTML = '';
            
            if (!sectionType) {
                sectionSelect.innerHTML = '<option value="">First select section type...</option>';
                sectionSelect.disabled = true;
                return;
            }
            
            // Enable the section select
            sectionSelect.disabled = false;
            sectionSelect.innerHTML = '<option value="">Select section...</option>';
            
            // Add options based on selection
            if (sectionType === 'floor') {
                const floorSections = ['FL2', 'FL3', 'FL6', 'FL7', 'FL17', 'FL18', 'FL20', 'FL21'];
                floorSections.forEach(section => {
                    const option = document.createElement('option');
                    option.value = section;
                    option.textContent = section;
                    sectionSelect.appendChild(option);
                });
            } else if (sectionType === 'vip') {
                const vipSections = ['VIP2', 'VIP11', 'VIP12', 'VIP13', 'VIP21'];
                vipSections.forEach(section => {
                    const option = document.createElement('option');
                    option.value = section;
                    option.textContent = section;
                    sectionSelect.appendChild(option);
                });
            } else if (sectionType === 'lower') {
                for (let i = 1; i <= 22; i++) {
                    const option = document.createElement('option');
                    option.value = i.toString();
                    option.textContent = `Section ${i}`;
                    sectionSelect.appendChild(option);
                }
            } else if (sectionType === 'mid') {
                const midSections = ['107', '109', '111', '113', '115', '137', '139', '141', '143', '145'];
                midSections.forEach(section => {
                    const option = document.createElement('option');
                    option.value = section;
                    option.textContent = `Section ${section}`;
                    sectionSelect.appendChild(option);
                });
            } else if (sectionType === 'upper') {
                for (let i = 301; i <= 330; i++) {
                    const option = document.createElement('option');
                    option.value = i.toString();
                    option.textContent = `Section ${i}`;
                    sectionSelect.appendChild(option);
                }
            } else if (sectionType === 'special') {
                const specialAreas = [
                    { value: 'suites', label: 'Suites' },
                    { value: 'lounge', label: 'Lounge' },
                    { value: 'garden-view', label: 'Garden View' },
                    { value: 'exec-suites', label: 'Executive Suites' },
                    { value: 'garden-deck', label: 'Garden Deck' },
                    { value: 'lofts', label: 'Lofts' },
                    { value: 'rafters', label: 'Rafters' }
                ];
                
                specialAreas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area.value;
                    option.textContent = area.label;
                    sectionSelect.appendChild(option);
                });
            }
            
            // Update price estimate
            updatePriceEstimate();
        }

        // Submit ticket request
        async function submitTicketRequest(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const ticketData = Object.fromEntries(formData.entries());
            
            // Get price information from the price estimate section
            const basePrice = parseFloat(document.getElementById('basePrice').textContent.replace('$', '')) || 0;
            const serviceFee = parseFloat(document.getElementById('serviceFee').textContent.replace('$', '')) || 0;
            const processingFee = parseFloat(document.getElementById('processingFee').textContent.replace('$', '')) || 0;
            const totalPrice = parseFloat(document.getElementById('totalPrice').textContent.replace('$', '')) || 0;
            
            // Format section type to match the backend expectations
            // The server expects: Floor, Vip, Lower, Mid, Upper, Special
            let formattedSectionType = ticketData.sectionType;
            switch(ticketData.sectionType) {
                case 'floor':
                    formattedSectionType = 'Floor';
                    break;
                case 'vip':
                    formattedSectionType = 'Vip';
                    break;  
                case 'lower':
                    formattedSectionType = 'Lower';
                    break;
                case 'mid':
                    formattedSectionType = 'Mid';
                    break;
                case 'upper':
                    formattedSectionType = 'Upper';
                    break;
                case 'special':
                    formattedSectionType = 'Special';
                    break;
            }
            
            // Update the ticket data with formatted section type
            ticketData.sectionType = formattedSectionType;
            
            // Add price information to the ticket data
            ticketData.basePrice = basePrice;
            ticketData.serviceFee = serviceFee;
            ticketData.processingFee = processingFee;
            ticketData.totalPrice = totalPrice;
            
            // Validate all inputs
            const formInputs = form.querySelectorAll('select, input, textarea');
            let isValid = true;
            
            formInputs.forEach(input => {
                if (!validateInput(input)) {
                    isValid = false;
                }
            });
            
            if (!isValid) {
                document.getElementById('errorMessage').textContent = 'Please fill in all required fields';
                document.getElementById('errorMessage').style.display = 'block';
                return;
            }

            // Disable form during submission
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            // Clear previous messages
            document.getElementById('errorMessage').textContent = '';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').textContent = '';
            document.getElementById('successMessage').style.display = 'none';
            
            try {
                console.log('Submitting ticket data:', JSON.stringify(ticketData));
                
                const response = await fetch('/api/tickets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(ticketData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Hide the form to make the success message more prominent
                    form.style.display = 'none';
                    
                    // Show enhanced success message
                    const successMsg = document.getElementById('successMessage');
                    successMsg.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <i class="fas fa-check-circle" style="font-size: 48px; color: #28a745; margin-bottom: 20px;"></i>
                            <h2 style="margin-bottom: 15px;">Request Submitted Successfully!</h2>
                            <p>${data.message || 'Your ticket request has been submitted successfully.'}</p>
                            <p>You'll be redirected to the home page in a few seconds...</p>
                            <div style="margin-top: 20px;">
                                <div class="countdown" style="font-size: 24px; font-weight: bold;">5</div>
                            </div>
                        </div>
                    `;
                    successMsg.style.display = 'block';
                    
                    // Scroll to make sure the success message is visible
                    successMsg.scrollIntoView({ behavior: 'smooth' });
                    
                    // Reset form data (won't be visible but resets the state)
                    form.reset();
                    
                    // Reset progress steps
                    document.querySelectorAll('.progress-step').forEach(step => {
                        step.classList.remove('active', 'completed');
                    });
                    document.querySelector('.progress-step:first-child').classList.add('active');
                    
                    // Hide price estimate
                    document.getElementById('priceEstimate').style.display = 'none';
                    
                    // Countdown before redirect
                    let countdown = 5;
                    const countdownEl = document.querySelector('.countdown');
                    
                    const timer = setInterval(() => {
                        countdown--;
                        countdownEl.textContent = countdown;
                        
                        if (countdown <= 0) {
                            clearInterval(timer);
                            window.location.href = "/";
                        }
                    }, 1000);
                } else {
                    // Show error message
                    document.getElementById('errorMessage').innerHTML = `
                        <i class="fas fa-exclamation-triangle"></i> ${data.error || data.message || 'Error submitting ticket request'}
                    `;
                    document.getElementById('errorMessage').style.display = 'block';
                    
                    // Scroll to error message
                    document.getElementById('errorMessage').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                console.error('Error submitting ticket request:', error);
                document.getElementById('errorMessage').innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i> Error connecting to server. Please try again later.
                `;
                document.getElementById('errorMessage').style.display = 'block';
                
                // Scroll to error message
                document.getElementById('errorMessage').scrollIntoView({ behavior: 'smooth' });
            } finally {
                // Re-enable form if there was an error
                if (document.getElementById('errorMessage').style.display === 'block') {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Submit Request';
                }
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            checkAccessAndRender();
            });
    </script>
    <script src="../js/navbar.js"></script>
</body>
</html> 